# wechat-on-airflow

## 项目简介

wechat-on-airflow 是一个基于 Apache Airflow 的项目，用于管理和编排 AI 驱动的微信聊天机器人工作流，实现自动回复消息、定时发送通知、自动更新菜单以及与微信 API 集成等自动化任务，提升微信机器人的响应效率和运营优化。

## 整体架构

```
                                         👤 👤 👤 👤 👤
+-----------------------------------------------------------------------------------------+          +-----------+
|                      🖥️  用户浏览器： 访问网站管理页面（Web前端）                              | -[公网]->| 🔑 鉴权服务 |  
+-----------------------------------------------------------------------------------------+          +-----------+
                                               |                                                    
                                         [公网]  Https://lucyai.sale                                          
                                               ↓                                                    
+-----------------------------------------------------------------------------------------+         +------------+      
|                                    🔄 Nginx (后端服务代理)                                | -[内网]->| 🗳️ Web服务器|  
+-----------------------------------------------------------------------------------------+         +------------+      
      |                                        |                             |
[内网]查询聊天记录(触发式）      [内网]发送消息\查询状态数据(触发式+定时任务）    [内网]知识库接口(触发式)       
      ↓                                        ↓                             ↓   
+---------+       +---------+       +------------------------+         +-------------------+       +-------------+
| ☁️ 云函数 | <---> | 💾 Mysql | <--->| ⭐️ Airflow （开源项目）   |-[跨境]->| 🤖 Dify （开源项目） | ----> | 🧠 大模型服务 |
+---------+       +---------+   <-> +------------------------+         +-------------------+       +-------------+
                               |            ↑              |
                               |    +-------------------+  |
     |--------------------------    | 🔌 Nginx (开源组件) |  WCF API
     |              |               +-------------------+  |
     |              |                       ↑              |
  新消息上报    发送消息\查询数据      [内网]上报新消息(触发式)  [内网]发送消息\查询数据(触发式+定时任务）
     |              |                       |              ↓
+---------+         |               +----------------------------+
| ☁️ 云函数 |         |               | 🔄 WCF (开源项目, Windows)   |
+---------+         |               +----------------------------+
     ↑              |                       ↑                |
     |              |                       |                |
  新消息上报     官方API接口               第三方Hook       第三方Hook
     |              ↓                       |                ↓
+----------------------------+      +---------------------------+
|       📢 微信公众号          |      | 💬 微信客户端 （Windows）    |
+----------------------------+      +---------------------------+


备注：
- WEB UI: 多账号管理的前端页面
- 个人微信客户端： 使用 wcf-client-rust 项目， 基于 wcf 协议， 实现微信客户端功能
- Webhook： 自研， 基于 HTTP API 实现
- Airflow： 开源项目， 用于管理和编排工作流
- Dify： 开源项目， 用于智能客服管理
- 大模型服务： 基于大模型 API 实现
- 云函数：使用腾讯云云函数，实现部分中转功能
- 微信公众号：官方提供的API接口
- Mysql: 购买腾讯云数据库，存储比较重要的聊天记录等数据
- Nginx: 主要负责负载均衡、转发流量等
- Nacos: 配置中心， 用于存储配置信息
- 鉴权服务： 用于用户注册、登录、鉴权等, 推荐使用Supabase Authentication
```

## 个人微信功能列表

- [x] 接收文字消息
- [x] 接收图片消息
- [x] 接收视频消息
- [ ] 接收文件消息
- [x] 发送文字消息
- [x] 发送图片消息
- [x] 发送视频消息
- [ ] 发送文件消息

## 微信公众号功能列表

- [x] 接收文字消息
- [x] 接收图片消息
- [x] 接收视频消息
- [ ] 接收文件消息
- [x] 发送文字消息
- [ ] 发送图片消息
- [ ] 发送视频消息
- [ ] 发送文件消息


## 关联项目

- [前端UI](https://github.com/YuChanGongzhu/ai-agent)
- [airflow](https://github.com/apache/airflow)
- [wcf-client-rust](https://github.com/lich0821/wcf-client-rust)
- [dify](https://github.com/langgenius/dify)

---

**Contributors**

<a href="https://github.com/claude89757/wechat-on-airflow/graphs/contributors">
  <img src="https://contrib.rocks/image?repo=claude89757/wechat-on-airflow" />
</a>

# WcfRust自动启动脚本

这个Python脚本可以自动找到并点击Windows桌面上的WcfRust图标，然后在应用程序中点击"启动"按钮。

## 前提条件

- Python 3.12
- 安装所需的依赖库

## 安装

1. 确保你已经安装了Python 3.12
2. 安装依赖：

```bash
pip install -r requirements.txt
```

## 准备工作

在运行脚本前，你需要准备两张图片：

1. `wcf_icon.png` - WcfRust在桌面上的图标截图
2. `start_button.png` - WcfRust应用程序中"启动"按钮的截图

截图方法：
1. 使用Windows自带的截图工具或任何截图软件
2. 只截取图标或按钮本身，不要包含太多周围内容
3. 将截图保存在与脚本相同的目录中

## 使用方法

1. 确保桌面上有WcfRust图标且可见
2. 运行脚本：

```bash
python auto_start_wcf.py
```

3. 脚本开始运行后，请不要移动鼠标，直到操作完成

## 安全特性

- 将鼠标快速移动到屏幕左上角可以中断脚本执行
- 脚本执行过程中会有日志输出
- 如果找不到目标图标或按钮，会自动截图保存以便调试

## 故障排除

如果脚本无法找到图标或按钮：

1. 检查截图质量，确保清晰可辨
2. 调整脚本中的`CONFIDENCE`值（默认0.7），降低该值可以提高匹配容忍度
3. 查看生成的错误截图，检查目标是否可见

## 注意事项

- 此脚本依赖于屏幕上的视觉元素，如果界面发生变化，可能需要重新截图
- 使用时确保屏幕亮度适中，避免反光或过暗影响识别
