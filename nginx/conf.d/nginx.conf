user root;
worker_processes auto;
pid /run/nginx.pid;

# OpenResty不需要显式加载core.so模块，这是一个Lua模块而不是动态库
# 移除这行，改为在http中使用lua_init_by_lua代码段

events {
    worker_connections 1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    # 初始化Lua环境，加载resty.core模块
    init_by_lua_block {
        require "resty.core"
    }

    # 日志格式
    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                     '$status $body_bytes_sent "$http_referer" '
                     '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /usr/local/openresty/nginx/logs/access.log  main;
    error_log   /usr/local/openresty/nginx/logs/error.log warn;

    # Lua相关配置
    lua_socket_log_errors off;
    lua_check_client_abort on;
    lua_socket_connect_timeout 60s;
    lua_socket_send_timeout 60s;
    lua_socket_read_timeout 60s;
    
    # Shell命令执行配置
    lua_shared_dict shell_result 10m;
    
    # 配置shell命令执行
    lua_package_path "/usr/local/openresty/lualib/?.lua;;";
    lua_package_cpath "/usr/local/openresty/lualib/?.so;;";
    
    # 包含其他配置文件
    include /etc/nginx/conf.d/*.conf;
} 